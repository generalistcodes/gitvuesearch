<template>
  <div id="app">
    <img alt="Git logo" src="./assets/logo.svg">
    <div class="text-center">
      <input type="text" placeholder="Search github repository." class="input-text" v-model="reponame" v-on:keyup="getList">
    </div>
    <br>
    <div v-if="listLoading && reponame" class="loading">
          Searching... 
    </div>
    <br>
    <div class="sort-box"  v-if="reponame">
      <b>Sort <small class="small-label">{{reponame}}</small> by : </b>
      <button class="white-btn" @click="sortBy('-stargazers_count')">Highest stars</button>
      <button class="white-btn" @click="sortBy('stargazers_count')">Lowest stars</button>
      <button class="white-btn" @click="sortBy('-updated_at')">Latest</button>
      <button class="white-btn" @click="sortBy('updated_at')">Oldest</button>
    </div>
    <br>
    <GitDisplay :data="list"/>

    <pagination
      v-show="total>0"
      :total="total"
      :page.sync="listQuery.page"
      :limit.sync="listQuery.limit"
      @pagination="getList"
    />
  </div>
</template>

<script lang="ts">
import { Component, Vue } from 'vue-property-decorator'; 
import GitDisplay from './components/GitDisplay.vue'; 
import Pagination from '@/components/Pagination.vue';
import gitService from '@/api/github';
import { sortBy } from '@/utils/sort';

@Component({
  components: {
    GitDisplay,
    Pagination
  },
})
export default class App extends Vue {
  loading: boolean = false
  gitResults = [];
  total = 0
  list: [] = []
  listLoading = true

  reponame: any = "";
  
  listQuery = {
    page: 1,
    limit: 10
  }
  currentPage: any  = 1
  // public sortName: string = 'stars'
  //pagination
  githubPage: number = 1
  page: number = 1
  postPerPage: number = 5
  repos = []
  posts: any;

  lastPage: any;
  postsPerPage: any;


//  created() {
//     this.getList()
//   } 

  private async getList() {
    this.listLoading = true
    if(this.reponame) {
      const { data } = await gitService.query(this.listQuery, this.reponame);
      console.log("---daf", data)
      this.list = data.items
      this.total = data.total_count
      // Just to simulate the time of the request
      setTimeout(() => {
        this.listLoading = false
      }, 0.5 * 1000)
    }
  }
  
  sortBy(sortName: string = 'stargazers_count') {
    this.list = this.list.sort(sortBy(sortName))
    return this.gitResults
  }

  public clear() {
    return this.gitResults = [];
  }  

}
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
.loading {
    padding: 10px;
}

</style>
